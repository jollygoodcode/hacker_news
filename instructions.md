##### 1.1 Install rspec-rails 3.3.3

- `Gemfile`

  ```diff

   group :development, :test do
     gem "byebug"
  +  gem "rspec-rails", "~> 3.3.3" # lock here so this tutorial won't break
   end

   group :development do
  ```

- `Gemfile.lock`

  ```diff
         coffee-script-source
         execjs
       coffee-script-source (1.9.1.1)
  +    diff-lcs (1.2.5)
       erubis (2.7.0)
       execjs (2.6.0)
       globalid (0.3.6)
  @@ -94,6 +95,23 @@ GEM
         rake (>= 0.8.7)
         thor (>= 0.18.1, < 2.0)
       rake (10.4.2)
  +    rspec-core (3.3.2)
  +      rspec-support (~> 3.3.0)
  +    rspec-expectations (3.3.1)
  +      diff-lcs (>= 1.2.0, < 2.0)
  +      rspec-support (~> 3.3.0)
  +    rspec-mocks (3.3.2)
  +      diff-lcs (>= 1.2.0, < 2.0)
  +      rspec-support (~> 3.3.0)
  +    rspec-rails (3.3.3)
  +      actionpack (>= 3.0, < 4.3)
  +      activesupport (>= 3.0, < 4.3)
  +      railties (>= 3.0, < 4.3)
  +      rspec-core (~> 3.3.0)
  +      rspec-expectations (~> 3.3.0)
  +      rspec-mocks (~> 3.3.0)
  +      rspec-support (~> 3.3.0)
  +    rspec-support (3.3.0)
       sass (3.4.18)
       sass-rails (5.0.4)
         railties (>= 4.0.0, < 5.0)
  @@ -128,6 +146,7 @@ DEPENDENCIES
     jquery-rails
     pg
     rails (= 4.2.4)
  +  rspec-rails (~> 3.3.3)
     sass-rails (~> 5.0)
     spring
     turbolinks
  ```

##### 1.2 $ rails g rspec:install

- `.rspec`

  ```diff
  +--color
  +--require spec_helper
  ```

- `spec/rails_helper.rb`

  ```diff
  +# This file is copied to spec/ when you run 'rails generate rspec:install'
  +ENV['RAILS_ENV'] ||= 'test'
  +require File.expand_path('../../config/environment', __FILE__)
  +# Prevent database truncation if the environment is production
  +abort("The Rails environment is running in production mode!") if Rails.env.production?
  +require 'spec_helper'
  +require 'rspec/rails'
  +# Add additional requires below this line. Rails is not loaded until this point!
  +
  +# Requires supporting ruby files with custom matchers and macros, etc, in
  +# spec/support/ and its subdirectories. Files matching `spec/**/*_spec.rb` are
  +# run as spec files by default. This means that files in spec/support that end
  +# in _spec.rb will both be required and run as specs, causing the specs to be
  +# run twice. It is recommended that you do not name files matching this glob to
  +# end with _spec.rb. You can configure this pattern with the --pattern
  +# option on the command line or in ~/.rspec, .rspec or `.rspec-local`.
  +#
  +# The following line is provided for convenience purposes. It has the downside
  +# of increasing the boot-up time by auto-requiring all files in the support
  +# directory. Alternatively, in the individual `*_spec.rb` files, manually
  +# require only the support files necessary.
  +#
  +# Dir[Rails.root.join('spec/support/**/*.rb')].each { |f| require f }
  +
  +# Checks for pending migrations before tests are run.
  +# If you are not using ActiveRecord, you can remove this line.
  +ActiveRecord::Migration.maintain_test_schema!
  +
  +RSpec.configure do |config|
  +  # Remove this line if you're not using ActiveRecord or ActiveRecord fixtures
  +  config.fixture_path = "#{::Rails.root}/spec/fixtures"
  +
  +  # If you're not using ActiveRecord, or you'd prefer not to run each of your
  +  # examples within a transaction, remove the following line or assign false
  +  # instead of true.
  +  config.use_transactional_fixtures = true
  +
  +  # RSpec Rails can automatically mix in different behaviours to your tests
  +  # based on their file location, for example enabling you to call `get` and
  +  # `post` in specs under `spec/controllers`.
  +  #
  +  # You can disable this behaviour by removing the line below, and instead
  +  # explicitly tag your specs with their type, e.g.:
  +  #
  +  #     RSpec.describe UsersController, :type => :controller do
  +  #       # ...
  +  #     end
  +  #
  +  # The different available types are documented in the features, such as in
  +  # https://relishapp.com/rspec/rspec-rails/docs
  +  config.infer_spec_type_from_file_location!
  +end
  ```

- `spec/spec_helper.rb`

  ```diff
  +# This file was generated by the `rails generate rspec:install` command. Conventionally, all
  +# specs live under a `spec` directory, which RSpec adds to the `$LOAD_PATH`.
  +# The generated `.rspec` file contains `--require spec_helper` which will cause
  +# this file to always be loaded, without a need to explicitly require it in any
  +# files.
  +#
  +# Given that it is always loaded, you are encouraged to keep this file as
  +# light-weight as possible. Requiring heavyweight dependencies from this file
  +# will add to the boot time of your test suite on EVERY test run, even for an
  +# individual file that may not need all of that loaded. Instead, consider making
  +# a separate helper file that requires the additional dependencies and performs
  +# the additional setup, and require it from the spec files that actually need
  +# it.
  +#
  +# The `.rspec` file also contains a few flags that are not defaults but that
  +# users commonly want.
  +#
  +# See http://rubydoc.info/gems/rspec-core/RSpec/Core/Configuration
  +RSpec.configure do |config|
  +  # rspec-expectations config goes here. You can use an alternate
  +  # assertion/expectation library such as wrong or the stdlib/minitest
  +  # assertions if you prefer.
  +  config.expect_with :rspec do |expectations|
  +    # This option will default to `true` in RSpec 4. It makes the `description`
  +    # and `failure_message` of custom matchers include text for helper methods
  +    # defined using `chain`, e.g.:
  +    #     be_bigger_than(2).and_smaller_than(4).description
  +    #     # => "be bigger than 2 and smaller than 4"
  +    # ...rather than:
  +    #     # => "be bigger than 2"
  +    expectations.include_chain_clauses_in_custom_matcher_descriptions = true
  +  end
  +
  +  # rspec-mocks config goes here. You can use an alternate test double
  +  # library (such as bogus or mocha) by changing the `mock_with` option here.
  +  config.mock_with :rspec do |mocks|
  +    # Prevents you from mocking or stubbing a method that does not exist on
  +    # a real object. This is generally recommended, and will default to
  +    # `true` in RSpec 4.
  +    mocks.verify_partial_doubles = true
  +  end
  +
  +# The settings below are suggested to provide a good initial experience
  +# with RSpec, but feel free to customize to your heart's content.
  +=begin
  +  # These two settings work together to allow you to limit a spec run
  +  # to individual examples or groups you care about by tagging them with
  +  # `:focus` metadata. When nothing is tagged with `:focus`, all examples
  +  # get run.
  +  config.filter_run :focus
  +  config.run_all_when_everything_filtered = true
  +
  +  # Allows RSpec to persist some state between runs in order to support
  +  # the `--only-failures` and `--next-failure` CLI options. We recommend
  +  # you configure your source control system to ignore this file.
  +  config.example_status_persistence_file_path = "spec/examples.txt"
  +
  +  # Limits the available syntax to the non-monkey patched syntax that is
  +  # recommended. For more details, see:
  +  #   - http://myronmars.to/n/dev-blog/2012/06/rspecs-new-expectation-syntax
  +  #   - http://www.teaisaweso.me/blog/2013/05/27/rspecs-new-message-expectation-syntax/
  +  #   - http://myronmars.to/n/dev-blog/2014/05/notable-changes-in-rspec-3#new__config_option_to_disable_rspeccore_monkey_patching
  +  config.disable_monkey_patching!
  +
  +  # Many RSpec users commonly either run the entire suite or an individual
  +  # file, and it's useful to allow more verbose output when running an
  +  # individual spec file.
  +  if config.files_to_run.one?
  +    # Use the documentation formatter for detailed output,
  +    # unless a formatter has already been configured
  +    # (e.g. via a command-line flag).
  +    config.default_formatter = 'doc'
  +  end
  +
  +  # Print the 10 slowest examples and example groups at the
  +  # end of the spec run, to help surface which specs are running
  +  # particularly slow.
  +  config.profile_examples = 10
  +
  +  # Run specs in random order to surface order dependencies. If you find an
  +  # order dependency and want to debug it, you can fix the order by providing
  +  # the seed, which is printed after each run.
  +  #     --seed 1234
  +  config.order = :random
  +
  +  # Seed global randomization in this process using the `--seed` CLI option.
  +  # Setting this allows you to use `--seed` to deterministically reproduce
  +  # test failures related to randomization by passing the same `--seed` value
  +  # as the one that triggered the failure.
  +  Kernel.srand config.seed
  +=end
  +end
  ```

##### 2.1 Install and setup capybara 2.5.0

- `Gemfile`

  ```diff
   group :development do
     gem "spring"
   end
  +
  +group :test do
  +  gem "capybara", "~> 2.5.0" # lock here so this tutorial won't break
  +end
  ```

- `Gemfile.lock`

  ```diff
       arel (6.0.3)
       builder (3.2.2)
       byebug (6.0.2)
  +    capybara (2.5.0)
  +      mime-types (>= 1.16)
  +      nokogiri (>= 1.3.3)
  +      rack (>= 1.0.0)
  +      rack-test (>= 0.5.4)
  +      xpath (~> 2.0)
       coffee-rails (4.1.0)
         coffee-script (>= 2.2.0)
         railties (>= 4.0.0, < 5.0)
  @@ -136,12 +142,15 @@ GEM
       uglifier (2.7.2)
         execjs (>= 0.3.0)
         json (>= 1.8.0)
  +    xpath (2.0.0)
  +      nokogiri (~> 1.3)

   PLATFORMS
     ruby

   DEPENDENCIES
     byebug
  +  capybara (~> 2.5.0)
     coffee-rails (~> 4.1.0)
     jquery-rails
     pg
  ```

- `spec/rails_helper.rb`

  ```diff
   require 'spec_helper'
   require 'rspec/rails'
   # Add additional requires below this line. Rails is not loaded until this point!
  -
  +require 'capybara/rails'
   # Requires supporting ruby files with custom matchers and macros, etc, in
   # spec/support/ and its subdirectories. Files matching `spec/**/*_spec.rb` are
   # run as spec files by default. This means that files in spec/support that end
  ```

##### 2.2 Create db/schema.rb by running migration

- `db/schema.rb`

  ```diff
  +# encoding: UTF-8
  +# This file is auto-generated from the current state of the database. Instead
  +# of editing this file, please use the migrations feature of Active Record to
  +# incrementally modify your database, and then regenerate this schema definition.
  +#
  +# Note that this schema.rb definition is the authoritative source for your
  +# database schema. If you need to create the application database on another
  +# system, you should be using db:schema:load, not running all the migrations
  +# from scratch. The latter is a flawed and unsustainable approach (the more migrations
  +# you'll amass, the slower it'll run and the greater likelihood for issues).
  +#
  +# It's strongly recommended that you check this file into your version control system.
  +
  +ActiveRecord::Schema.define(version: 0) do
  +
  +  # These are extensions that must be enabled in order to support this database
  +  enable_extension "plpgsql"
  +
  +end
  ```

##### 2.3 Add "Submits a link" feature spec

- `spec/features/submits_a_link_spec.rb`

  ```diff
  +require "rails_helper"
  +
  +RSpec.feature "Submits a link" do
  +  scenario "should see the page for the submitted link" do
  +    title = "deppbot"
  +    url = "https://www.deppbot.com"
  +
  +    visit root_path
  +    click_on "submit"
  +
  +    fill_in "Title", with: title
  +    fill_in "Url", with: url
  +    click_on "Submit"
  +
  +    expect(page).to have_link title, href: url
  +  end
  +end
  ```

##### 2.4 Add root path

- `config/routes.rb`

  ```diff
   Rails.application.routes.draw do
  +  root "links#index"
   end
  ```

##### 2.5 Add LinksController

- `app/controllers/links_controller.rb`

  ```diff
  +class LinksController
  +
  +end
  ```

##### 2.6 Inherit from ApplicationController

- `app/controllers/links_controller.rb`

  ```diff
  -class LinksController
  +class LinksController < ApplicationController

   end
  ```

##### 2.7 Add index action of LinksController

- `app/controllers/links_controller.rb`

  ```diff
   class LinksController < ApplicationController
  -
  +  def index
  +  end
   end
  ```

##### 2.8 Creates app/views/links/index.html.erb

- `app/views/links/index.html.erb`

##### 2.9 Add "submit" link to links index page

- `app/views/links/index.html.erb`

  ```diff
  +<%= link_to "submit", new_link_path %>
  ```

##### 2.10 Add new_link_path

- `config/routes.rb`

  ```diff
   Rails.application.routes.draw do
     root "links#index"
  +
  +  resources :links, only: [:new]
   end
  ```

##### 2.11 Add new action to LinksController

- `app/controllers/links_controller.rb`

  ```diff
   class LinksController < ApplicationController
     def index
     end
  +
  +  def new
  +  end
   end
  ```

##### 2.12 Add new link view template

- `app/views/links/new.html.erb`

##### 2.13 Add title & url fields to new link form

- `app/views/links/new.html.erb`

  ```diff
  +<%= form_for @link do |f| %>
  +  <div>
  +    <%= f.label :title %>
  +    <%= f.text_field :title %>
  +  </div>
  +
  +  <div>
  +    <%= f.label :url %>
  +    <%= f.text_field :url %>
  +  </div>
  +
  +  <%= f.submit "Submit" %>
  +<% end %>
  ```

##### 2.14 @link cannot be nil in form

- `app/controllers/links_controller.rb`

  ```diff
     end

     def new
  +    @link = Link.new
     end
   end
  ```

##### 2.15 Add Link class

- `app/models/link.rb`

  ```diff
  +class Link
  +
  +end
  ```

##### 2.16 Inherit from ActiveRecord::Base

- `app/models/link.rb`

  ```diff
  -class Link
  +class Link < ActiveRecord::Base

   end
  ```

##### 2.17 Create links table and link with title and url

- `db/migrate/20150919174717_create_links.rb`

  ```diff
  +class CreateLinks < ActiveRecord::Migration
  +  def change
  +    create_table :links do |t|
  +      t.string :title, null: false
  +      t.string :url, null: false
  +
  +      t.timestamps null: false
  +    end
  +  end
  +end
  ```

- `db/schema.rb`

  ```diff
   #
   # It's strongly recommended that you check this file into your version control system.

  -ActiveRecord::Schema.define(version: 0) do
  +ActiveRecord::Schema.define(version: 20150919174717) do

     # These are extensions that must be enabled in order to support this database
     enable_extension "plpgsql"

  +  create_table "links", force: :cascade do |t|
  +    t.string   "title",      null: false
  +    t.string   "url",        null: false
  +    t.datetime "created_at", null: false
  +    t.datetime "updated_at", null: false
  +  end
  +
   end
  ```

##### 2.18 Add create route

- `config/routes.rb`

  ```diff
   Rails.application.routes.draw do
     root "links#index"

  -  resources :links, only: [:new]
  +  resources :links, only: [:new, :create]
   end
  ```

##### 2.19 Add create action

- `app/controllers/links_controller.rb`

  ```diff
     def new
       @link = Link.new
     end
  +
  +  def create
  +  end
   end
  ```

##### 2.20 Implements create action

- `app/controllers/links_controller.rb`

  ```diff
     end

     def create
  +    @link = Link.create(model_params)
  +    redirect_to @link
     end
  +
  +  private
  +
  +    def model_params
  +      params.require(:link).permit(:title, :url)
  +    end
   end
  ```

##### 2.21 Add route to show a link

- `config/routes.rb`

  ```diff
   Rails.application.routes.draw do
     root "links#index"

  -  resources :links, only: [:new, :create]
  +  resources :links, only: [:new, :create, :show]
   end
  ```

##### 2.22 Add show action

- `app/controllers/links_controller.rb`

  ```diff
       redirect_to @link
     end

  +  def show
  +  end
  +
     private

       def model_params
  ```

##### 2.23 Add show template

- `app/views/links/show.html.erb`

##### 2.24 Implements link show page

- `app/views/links/show.html.erb`

  ```diff
  +<%= link_to @link.title, @link.url %>
  ```

##### 2.25 Set @link for show view

- `app/controllers/links_controller.rb`

  ```diff
     end

     def show
  +    @link = Link.find(params[:id])
     end

     private
  ```

##### 3.1 Add "Home Page" feature spec

- `spec/features/home_page_spec.rb`

  ```diff
  +require "rails_helper"
  +
  +RSpec.feature "Home Page" do
  +  scenario "should see submitted links" do
  +    link = FactoryGirl.create(:link)
  +
  +    visit root_path
  +
  +    expect(page).to have_link link.title, href: link.url
  +  end
  +end
  ```

##### 3.2 Install factory_girl_rails v4.5.0

- `Gemfile`

  ```diff
   group :development, :test do
     gem "byebug"
     gem "rspec-rails", "~> 3.3.3" # lock here so this tutorial won't break
  +  gem "factory_girl_rails", "~> 4.5.0" # lock here so this tutorial won't break
   end

   group :development do
  ```

- `Gemfile.lock`

  ```diff
       diff-lcs (1.2.5)
       erubis (2.7.0)
       execjs (2.6.0)
  +    factory_girl (4.5.0)
  +      activesupport (>= 3.0.0)
  +    factory_girl_rails (4.5.0)
  +      factory_girl (~> 4.5.0)
  +      railties (>= 3.0.0)
       globalid (0.3.6)
         activesupport (>= 4.1.0)
       i18n (0.7.0)
  @@ -152,6 +157,7 @@ DEPENDENCIES
     byebug
     capybara (~> 2.5.0)
     coffee-rails (~> 4.1.0)
  +  factory_girl_rails (~> 4.5.0)
     jquery-rails
     pg
     rails (= 4.2.4)
  ```

##### 3.3 Define link factory

- `spec/factories/link.rb`

  ```diff
  +FactoryGirl.define do
  +  factory :link do
  +  end
  +end
  ```

##### 3.4 Add necessary attributes

- `spec/factories/link.rb`

  ```diff
   FactoryGirl.define do
     factory :link do
  +    title "deppbot"
  +    url "https://www.deppbot.com"
     end
   end
  ```

##### 3.5 Render links in links page

- `app/views/links/index.html.erb`

  ```diff
   <%= link_to "submit", new_link_path %>
  +
  +<ul>
  +<% @links.each do |link| %>
  +  <li><%= link_to link.title, link.url %></li>
  +<% end %>
  +</ul>
  ```

##### 3.6 Pull out links from system

- `app/controllers/links_controller.rb`

  ```diff
   class LinksController < ApplicationController
     def index
  +    @links = Link.all
     end

     def new
  ```

##### 3.7 Save us from typing FactoryGirl in our specs

- `spec/features/home_page_spec.rb`

  ```diff

   RSpec.feature "Home Page" do
     scenario "should see submitted links" do
  -    link = FactoryGirl.create(:link)
  +    link = create(:link)

       visit root_path

  ```

- `spec/rails_helper.rb`

  ```diff
   # directory. Alternatively, in the individual `*_spec.rb` files, manually
   # require only the support files necessary.
   #
  -# Dir[Rails.root.join('spec/support/**/*.rb')].each { |f| require f }
  +Dir[Rails.root.join('spec/support/**/*.rb')].each { |f| require f }

   # Checks for pending migrations before tests are run.
   # If you are not using ActiveRecord, you can remove this line.
  ```

- `spec/support/factory_girl.rb`

  ```diff
  +RSpec.configure do |config|
  +  config.include FactoryGirl::Syntax::Methods
  +end
  ```

##### 3.8 Install database_rewinder v0.5.3

- `Gemfile`

  ```diff

   group :test do
     gem "capybara", "~> 2.5.0" # lock here so this tutorial won't break
  +  gem "database_rewinder"
   end
  ```

- `Gemfile.lock`

  ```diff
         coffee-script-source
         execjs
       coffee-script-source (1.9.1.1)
  +    database_rewinder (0.5.3)
       diff-lcs (1.2.5)
       erubis (2.7.0)
       execjs (2.6.0)
  @@ -157,6 +158,7 @@ DEPENDENCIES
     byebug
     capybara (~> 2.5.0)
     coffee-rails (~> 4.1.0)
  +  database_rewinder
     factory_girl_rails (~> 4.5.0)
     jquery-rails
     pg
  ```

##### 3.9 Setup database rewinder

- `spec/rails_helper.rb`

  ```diff
     # If you're not using ActiveRecord, or you'd prefer not to run each of your
     # examples within a transaction, remove the following line or assign false
     # instead of true.
  -  config.use_transactional_fixtures = true
  +  config.use_transactional_fixtures = false

     # RSpec Rails can automatically mix in different behaviours to your tests
     # based on their file location, for example enabling you to call `get` and
  ```

- `spec/support/database_rewinder.rb`

  ```diff
  +# https://github.com/amatsuda/database_rewinder#basic-configuration
  +RSpec.configure do |config|
  +  config.before :suite do
  +    DatabaseRewinder.clean_all
  +  end
  +
  +  config.after :each do
  +    DatabaseRewinder.clean
  +  end
  +end
  ```

##### 4.1 Setup Travis CI

- `.travis.yml`

  ```diff
  +language: ruby
  +rvm:
  +  - 2.2.3
  +before_script:
  +  - bin/setup
  +script:
  +  - bundle exec rspec
  ```

##### 4.2 Change to markdown [ci skip]

- `README.md`

  ```diff
  -== README
  +## README

   This README would normally document whatever steps are necessary to get the
   application up and running.
  ```

##### 4.3 Add build status badge [ci skip]

- `README.md`

  ```diff
   ## README

  +[![Build Status](https://travis-ci.org/jollygoodcode/hacker_news.svg)](https://travis-ci.org/jollygoodcode/hacker_news)
  +
   This README would normally document whatever steps are necessary to get the
   application up and running.

  ```

##### 6.1 Add "Sees score of link" feature spec

- `spec/features/sees_score_of_link_spec.rb`

  ```diff
  +require "rails_helper"
  +
  +RSpec.feature "Sees score of link" do
  +  scenario "should be displayed prior to link" do
  +    link = create(:link, scores: 1)
  +
  +    visit root_path
  +
  +    expect(page).to have_css "#link_#{link.id} [data-spec=score]", text: "1"
  +  end
  +end
  ```

##### 6.2 Add scores to links

- `db/migrate/20150920112054_add_scores_to_links.rb`

  ```diff
  +class AddScoresToLinks < ActiveRecord::Migration
  +  def change
  +    add_column :links, :scores, :integer, default: 0, null: false
  +  end
  +end
  ```

- `db/schema.rb`

  ```diff
   #
   # It's strongly recommended that you check this file into your version control system.

  -ActiveRecord::Schema.define(version: 20150919174717) do
  +ActiveRecord::Schema.define(version: 20150920112054) do

     # These are extensions that must be enabled in order to support this database
     enable_extension "plpgsql"

     create_table "links", force: :cascade do |t|
  -    t.string   "title",      null: false
  -    t.string   "url",        null: false
  -    t.datetime "created_at", null: false
  -    t.datetime "updated_at", null: false
  +    t.string   "title",                  null: false
  +    t.string   "url",                    null: false
  +    t.datetime "created_at",             null: false
  +    t.datetime "updated_at",             null: false
  +    t.integer  "scores",     default: 0, null: false
     end

   end
  ```

##### 6.3 Show link scores prior to link

- `app/views/links/index.html.erb`

  ```diff

   <ul>
   <% @links.each do |link| %>
  -  <li><%= link_to link.title, link.url %></li>
  +  <li id=<%= dom_id(link) %>>
  +    <div data-spec="score"><%= link.scores %></div>
  +    <%= link_to link.title, link.url %>
  +  </li>
   <% end %>
   </ul>
  ```

##### 7.1 Add "Upvotes a link" feature spec

- `spec/features/upvotes_a_link_spec.rb`

  ```diff
  +require "rails_helper"
  +
  +RSpec.feature "Upvotes a link" do
  +  scenario "should see the page for the submitted link" do
  +    link = create(:link, scores: 1)
  +
  +    visit root_path
  +
  +    within "#link_#{link.id}" do
  +      click_on "+1"
  +    end
  +
  +    expect(page).to have_css "#link_#{link.id} [data-spec=score]", text: "2"
  +  end
  +end
  ```

##### 7.2 Add +1 (upvote) link

- `app/views/links/index.html.erb`

  ```diff
   <% @links.each do |link| %>
     <li id=<%= dom_id(link) %>>
       <div data-spec="score"><%= link.scores %></div>
  +    <%= link_to "+1", "#" %>
       <%= link_to link.title, link.url %>
     </li>
   <% end %>
  ```

##### 7.3 Add upvote route

- `app/views/links/index.html.erb`

  ```diff
   <% @links.each do |link| %>
     <li id=<%= dom_id(link) %>>
       <div data-spec="score"><%= link.scores %></div>
  -    <%= link_to "+1", "#" %>
  +    <%= link_to "+1", link_upvote_path(link), method: :post %>
       <%= link_to link.title, link.url %>
     </li>
   <% end %>
  ```

- `config/routes.rb`

  ```diff
   Rails.application.routes.draw do
     root "links#index"

  -  resources :links, only: [:new, :create, :show]
  +  resources :links, only: [:new, :create, :show] do
  +    post "/upvote" => "upvotes#create"
  +  end
   end
  ```

##### 7.4 Create UpvotesController

- `app/controllers/upvotes_controller.rb`

  ```diff
  +class UpvotesController < ApplicationController
  +
  +end
  ```

##### 7.5 Implements UpvotesController#create

- `app/controllers/upvotes_controller.rb`

  ```diff
   class UpvotesController < ApplicationController
  +  def create
  +    Link.find(params[:link_id]).upvote

  +    redirect_to root_path
  +  end
   end
  ```

##### 7.6 Add Link#upvote

- `app/models/link.rb`

  ```diff
   class Link < ActiveRecord::Base
  -
  +  def upvote
  +  end
   end
  ```

##### 7.7 Implement Link#upvote and all specs passed

- `app/models/link.rb`

  ```diff
   class Link < ActiveRecord::Base
     def upvote
  +    increment!(:scores)
     end
   end
  ```

- `spec/models/link_spec.rb`

  ```diff
  +require "rails_helper"
  +
  +RSpec.describe Link do
  +  describe "#upvote" do
  +    it "increments scores by 1" do
  +      link = build(:link, scores: 1)
  +
  +      link.upvote
  +
  +      expect(link.scores).to eq 2
  +    end
  +  end
  +end
  ```

##### 8.1 Add validations and specs for Link model

- `app/models/link.rb`

  ```diff
   class Link < ActiveRecord::Base
  +  validates_presence_of :title
  +  validates_presence_of :url
  +
     def upvote
       increment!(:scores)
     end
  ```

- `spec/models/link_spec.rb`

  ```diff
   require "rails_helper"

   RSpec.describe Link do
  +  context "validations" do
  +    it { is_expected.to validate_presence_of(:title) }
  +    it { is_expected.to validate_presence_of(:url)   }
  +  end
  +
     describe "#upvote" do
       it "increments scores by 1" do
         link = build(:link, scores: 1)
  ```

##### 8.2 Install shoulda-matchers v2.8.0

- `Gemfile`

  ```diff
   group :test do
     gem "capybara", "~> 2.5.0" # lock here so this tutorial won't break
     gem "database_rewinder"
  +  gem "shoulda-matchers", "~> 2.8.0", require: false
   end
  ```

- `Gemfile.lock`

  ```diff
         sprockets (>= 2.8, < 4.0)
         sprockets-rails (>= 2.0, < 4.0)
         tilt (>= 1.1, < 3)
  +    shoulda-matchers (2.8.0)
  +      activesupport (>= 3.0.0)
       spring (1.4.0)
       sprockets (3.3.4)
         rack (~> 1.0)
  @@ -165,6 +167,7 @@ DEPENDENCIES
     rails (= 4.2.4)
     rspec-rails (~> 3.3.3)
     sass-rails (~> 5.0)
  +  shoulda-matchers (~> 2.8.0)
     spring
     turbolinks
     uglifier (>= 1.3.0)
  ```

- `spec/rails_helper.rb`

  ```diff
   require 'rspec/rails'
   # Add additional requires below this line. Rails is not loaded until this point!
   require 'capybara/rails'
  +require 'shoulda/matchers'
   # Requires supporting ruby files with custom matchers and macros, etc, in
   # spec/support/ and its subdirectories. Files matching `spec/**/*_spec.rb` are
   # run as spec files by default. This means that files in spec/support that end
  ```

##### 8.3 Test that when submitting invalid link at controller level

- `app/controllers/links_controller.rb`

  ```diff
     end

     def create
  -    @link = Link.create(model_params)
  -    redirect_to @link
  +    @link = Link.new(model_params)
  +
  +    if @link.save
  +      redirect_to @link
  +    else
  +      render :new
  +    end
     end

     def show
  ```

- `spec/controllers/links_controller_spec.rb`

  ```diff
  +require "rails_helper"
  +
  +RSpec.describe LinksController do
  +  describe "#create" do
  +    def do_request
  +      post :create, link: params
  +    end
  +
  +    context "failure" do
  +      let(:params) { Hash(url: nil) }
  +
  +      it "doesn't create" do
  +        expect { do_request }.not_to change(Link, :count)
  +      end
  +
  +      it "renders new" do
  +        do_request
  +        expect(response).to render_template(:new)
  +      end
  +    end
  +  end
  +end
  ```

##### 8.4 Complete the links controller spec

- `spec/controllers/links_controller_spec.rb`

  ```diff
         post :create, link: params
       end

  +    context "success" do
  +      let(:params) { Hash(title: "depbbot.com", url: "https://www.deppbot.com") }
  +
  +      it "creates a link" do
  +        expect { do_request }.to change(Link, :count).by(1)
  +      end
  +
  +      it "redirects" do
  +        do_request
  +        expect(response).to redirect_to link_path(assigns(:link))
  +      end
  +    end
  +
       context "failure" do
         let(:params) { Hash(url: nil) }

  ```

##### 8.5 Add "submits an invalid link" feature spec

- `spec/features/submits_a_link_spec.rb`

  ```diff

       expect(page).to have_link title, href: url
     end
  +
  +  context "invalid link" do
  +    scenario "should see error messages" do
  +      title = "deppbot"
  +
  +      visit new_link_path
  +
  +      fill_in "Title", with: title
  +      click_on "Submit"
  +
  +      expect(page).to have_content "Url can't be blank"
  +    end
  +  end
   end
  ```

##### 8.6 Render errors in new link page

- `app/views/application/_form_errors.html.erb`

  ```diff
  +<% if object.errors.any? %>
  +  <div>
  +    <strong>Sorry! We were not able to save due to the following errors:</strong>
  +    <ul>
  +      <% object.errors.full_messages.each do |error| %>
  +        <li><%= error %></li>
  +      <% end %>
  +    </ul>
  +  </div>
  +<% end %>
  ```

- `app/views/links/new.html.erb`

  ```diff
   <%= form_for @link do |f| %>
  +  <%= render "form_errors", object: @link %>
  +
     <div>
       <%= f.label :title %>
       <%= f.text_field :title %>
  ```

##### 9.1 Test LinksController#index

- `spec/controllers/links_controller_spec.rb`

  ```diff
   require "rails_helper"

   RSpec.describe LinksController do
  +  describe "#index" do
  +    def do_request
  +      get :index
  +    end
  +
  +    it "success" do
  +      do_request
  +      expect(response).to be_success
  +    end
  +  end
  +
     describe "#create" do
       def do_request
         post :create, link: params
  ```

##### 9.2 Test LinksController#new

- `spec/controllers/links_controller_spec.rb`

  ```diff
       end
     end

  +  describe "#new" do
  +    def do_request
  +      get :new
  +    end
  +
  +    it "success" do
  +      do_request
  +      expect(response).to be_success
  +    end
  +  end
  +
     describe "#create" do
       def do_request
         post :create, link: params
  ```

##### 9.3 Test LinksController#show

- `spec/controllers/links_controller_spec.rb`

  ```diff
         end
       end
     end
  +
  +  describe "#show" do
  +    let(:link) { create(:link) }
  +
  +    def do_request
  +      get :show, id: link.id
  +    end
  +
  +    it "success" do
  +      do_request
  +      expect(response).to be_success
  +    end
  +  end
   end
  ```
